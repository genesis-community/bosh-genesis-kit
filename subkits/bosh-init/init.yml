---
resource_pools:
- name: (( grab params.bosh_vm_type ))
  network: (( grab params.bosh_network ))
  env:
    bosh:
      password: (( grab meta.vcap_password ))
      mbus:
        cert: 
          ca: (( vault meta.vault "/ssl/ca:certificate" ))
          certificate: (( vault meta.vault "/ssl/mbus:certificate" ))
          private_key: (( vault meta.vault "/ssl/mbus:key" ))

disk_pools:
  - name: (( grab params.bosh_disk_pool ))
    disk_size: (( grab params.persistent_disk_size ))

instance_groups:
- name: bosh
  resource_pool: (( grab params.bosh_vm_type ))
  vm_type: (( prune ))
  persistent_disk_pool: (( grab params.bosh_disk_pool ))
  persistent_disk_type: (( prune ))

networks:
- name: (( grab params.bosh_network ))
  type: manual
  subnets:
  - range:    (( grab params.subnet_addr ))
    gateway:  (( grab params.default_gateway ))
    dns:      (( grab params.dns ))
    static: [ (( grab params.static_ip )) ]

cloud_provider:
  mbus: (( concat "https://mbus:" meta.mbus_bootstrap_password "@" params.static_ip ":6868" ))
  cert:
    ca: (( vault meta.vault "/ssl/ca:certificate" ))
    certificate: (( vault meta.vault "/ssl/mbus:certificate" ))
    private_key: (( vault meta.vault "/ssl/mbus:key" ))

  properties:
    agent:
      mbus: (( concat "https://mbus:" meta.mbus_bootstrap_password "@0.0.0.0:6868" ))
    ntp: (( grab params.ntp ))
